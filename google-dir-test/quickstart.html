<html>
  <head>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>



    <script type="text/javascript">
      // Your Client ID can be retrieved from your project in the Google
      // Developer Console, https://console.developers.google.com
      var CLIENT_ID = '88230792771-sfqdsio0m68c010sak58qhapee9aqstv.apps.googleusercontent.com';
      var SCOPES = ['https://www.googleapis.com/auth/admin.directory.user.readonly'];

      /**
       * Check if current user has authorized this application.
       */
      function checkAuth() {
        gapi.auth.authorize(
          {
            'client_id': CLIENT_ID,
            'scope': SCOPES.join(' '),
            'immediate': true
          }, handleAuthResult);
      }

      /**
       * Handle response from authorization server.
       *
       * @param {Object} authResult Authorization result.
       */
      function handleAuthResult(authResult) {
        var authorizeDiv = document.getElementById('authorize-div');
        if (authResult && !authResult.error) {
          // Hide auth UI, then load client library.
          authorizeDiv.style.display = 'none';
          loadDirectoryApi();
        } else {
          // Show auth UI, allowing the user to initiate authorization by
          // clicking authorize button.

          $("#auth-modal-dlg");

          $("#auth-modal-dlg").modal('show');


          //authorizeDiv.style.display = 'inline';
        }
      }

      /**
       * Initiate auth flow in response to user clicking authorize button.
       *
       * @param {Event} event Button click event.
       */
      function handleAuthClick(event) {
        gapi.auth.authorize(
          {client_id: CLIENT_ID, scope: SCOPES, immediate: false},
          handleAuthResult);
        return false;
      }

      function handleClearAuthClick(event) {
        var auth = gapi.auth.signOut();
      }

      /**
       * Load Directory API client library. List users once client library
       * is loaded.
       */
      function loadDirectoryApi() {
        gapi.client.load('admin', 'directory_v1', listUsers);
      }

      function test() {
        getUserImgSrc("vleipnik@miovision.com");
      }

      /**
       * Print the first 10 users in the domain.
       */
      function listUsers() {
        var request = gapi.client.directory.users.list({
          'customer': 'my_customer',
          'maxResults': 10,
          'orderBy': 'email',
          'viewType': 'domain_public'
        });

        request.execute(function(resp) {
          var users = resp.users;
          appendPre('Users:');

          if (users && users.length > 0) {
            for (i = 0; i < users.length; i++) {
              var user = users[i];
              appendPre('-' + user.primaryEmail + ' (' + user.name.fullName + ')');

              //getUserImgSrc(user.primaryEmail);
            }
          } else {
            appendPre('No users found.');
          }
        });
      }

      function getUserImgSrc(userEmail) {
        var request = gapi.client.directory.users.photos.get({
          'userKey': userEmail
        });

        request.execute(function(resp) {
          console.log(resp);

          if (resp.error) {
            console.log("Error loading img")
          } else {
            var imgElt = createImgElement(resp);
            var pre = document.getElementById("output");
            pre.appendChild(imgElt);
          }
        });
      }

      /**
       * Append a pre element to the body containing the given message
       * as its text node.
       *
       * @param {string} message Text to be placed in pre element.
       */
      function appendPre(message) {
        var pre = document.getElementById('output');
        var textContent = document.createTextNode(message + '\n');
        pre.appendChild(textContent);
      }

      function createImgElement(imgResultObj) {
        var img = document.createElement('img');
        var decoded = imgResultObj.photoData.replace(/_/g,'\/').replace(/-/g,'\+').replace(/\*/g,'='); 
        img.src = "data:" + imgResultObj.mimeType + ";base64," + decoded;
        return img;
      }

    </script>
    <script src="https://apis.google.com/js/client.js?onload=checkAuth&output=embed">
    </script>
  </head>
  <body>

    <div class="modal fade auth-modal-dlg" id="auth-modal-dlg" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <span>Authorize access to Directory API</span>
        <!--Button for the user to click to initiate auth sequence -->
        <button id="authorize-button2" onclick="handleAuthClick(event)">
          Authorize
        </button>
      </div>
    </div>
  </div>

<!--
      <span>Clear authorization</span>

      <button id="clear-autho-button" onclick="handleClearAuthClick(event)">
        Sign Out
      </button>
-->


<!-- Button trigger modal -->
<button type="button" class="btn btn-primary btn-lg"  data-toggle="modal" data-target="#myModal">
  Launch demo modal
</button>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

    <script type="text/javascript">



    </script>

    <pre id="output"></pre>
  </body>
</html>
